<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMA - Porte Monnaie Avoir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .balance-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .points-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        .ad-banner {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center px-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-16 h-16 gradient-bg rounded-xl flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-2xl">💰</span>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">PMA</h1>
                <p class="text-gray-600">Porte Monnaie Avoir</p>
            </div>

            <!-- Login/Register Toggle -->
            <div class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button id="loginTab" onclick="showLogin()" class="flex-1 py-2 px-4 rounded-md font-medium transition-all bg-white text-purple-600 shadow-sm">
                    Connexion
                </button>
                <button id="registerTab" onclick="showRegister()" class="flex-1 py-2 px-4 rounded-md font-medium transition-all text-gray-600">
                    Inscription
                </button>
            </div>

            <!-- Login Form -->
            <div id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Type de compte</label>
                        <select id="loginUserType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="client">Client</option>
                            <option value="merchant">Commerçant</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Téléphone</label>
                        <input type="tel" id="loginPhone" placeholder="+225 XX XX XX XX" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                        <input type="password" id="loginPassword" placeholder="••••••••" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <button onclick="login()" class="w-full gradient-bg text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity">
                        Se connecter
                    </button>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" style="display: none;">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Type de compte</label>
                        <select id="registerUserType" onchange="toggleShopField()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="client">Client</option>
                            <option value="merchant">Commerçant</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nom complet</label>
                        <input type="text" id="registerName" placeholder="Votre nom complet" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Téléphone</label>
                        <input type="tel" id="registerPhone" placeholder="+225 XX XX XX XX" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div id="shopNameField" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nom de la boutique</label>
                        <input type="text" id="registerShopName" placeholder="Nom de votre boutique" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                        <input type="password" id="registerPassword" placeholder="••••••••" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirmer mot de passe</label>
                        <input type="password" id="registerConfirmPassword" placeholder="••••••••" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <button onclick="register()" class="w-full gradient-bg text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity">
                        S'inscrire
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav id="mainNav" class="gradient-bg shadow-lg" style="display: none;">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-lg">💰</span>
                    </div>
                    <div>
                        <h1 class="text-white font-bold text-xl">PMA</h1>
                        <p class="text-white/80 text-xs">Porte Monnaie Avoir</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-white text-sm">
                        <div id="currentUser" class="font-medium">Utilisateur</div>
                        <div id="currentUserType" class="text-white/80 text-xs">Client</div>
                    </div>
                    <button onclick="logout()" class="bg-white/20 text-white border border-white/30 rounded-lg px-3 py-2 text-sm hover:bg-white/30 transition-colors">
                        Déconnexion
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Ad Banner (for clients) -->
    <div id="adBanner" class="ad-banner text-white p-4 text-center" style="display: none;">
        <div class="max-w-6xl mx-auto">
            <div class="flex items-center justify-center space-x-3">
                <span class="text-2xl">🎉</span>
                <div>
                    <p class="font-bold" id="adTitle">Promotion Spéciale !</p>
                    <p class="text-sm" id="adText">-20% sur tous les produits chez SuperMarché Plus</p>
                </div>
                <span class="text-xs bg-white/20 px-2 py-1 rounded">Pub</span>
            </div>
        </div>
    </div>

    <!-- Merchant Dashboard -->
    <div id="merchantDashboard" class="max-w-6xl mx-auto px-4 py-8" style="display: none;">
        <!-- Stats Cards -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-lg card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Total Avoirs</p>
                        <p id="totalAvoirs" class="text-2xl font-bold text-gray-800">125,500 FCFA</p>
                    </div>
                    <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
                        <span class="text-white text-xl">💳</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl shadow-lg card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Clients Inscrits</p>
                        <p id="registeredClients" class="text-2xl font-bold text-gray-800">47</p>
                    </div>
                    <div class="w-12 h-12 gradient-success rounded-xl flex items-center justify-center">
                        <span class="text-white text-xl">👥</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl shadow-lg card-hover">
                <div>
                    <p class="text-gray-600 text-sm">Abonnement Pub</p>
                    <p id="subscriptionStatus2" class="text-2xl font-bold text-gray-800">Inactif</p>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl shadow-lg card-hover">
                <div>
                    <p class="text-gray-600 text-sm">Pubs Cette Semaine</p>
                    <p id="weeklyAds" class="text-2xl font-bold text-gray-800">0/3</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">➕</span>
                    Créer un Avoir
                </h3>
                <div class="space-y-4">
                    <input type="tel" id="clientPhone" placeholder="Numéro de téléphone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <input type="number" id="avoirAmount" placeholder="Montant (FCFA)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <button onclick="createAvoir()" class="w-full gradient-bg text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity">
                        Créer l'Avoir
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">💰</span>
                    Traiter un Paiement
                </h3>
                <div class="space-y-4">
                    <input type="tel" id="paymentPhone" placeholder="Numéro client" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <input type="number" id="paymentAmount" placeholder="Montant à payer" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <button onclick="processPayment()" class="w-full gradient-success text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity">
                        Traiter le Paiement
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">📢</span>
                    Abonnement Pub
                </h3>
                <div class="space-y-4">
                    <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-4 rounded-lg">
                        <h4 class="font-bold text-purple-800 mb-2">Pack Publicitaire</h4>
                        <p class="text-sm text-purple-700 mb-2">✨ 3 publicités par semaine</p>
                        <p class="text-sm text-purple-700 mb-2">📱 Diffusion sur tous les clients</p>
                        <p class="text-2xl font-bold text-purple-800">15,000 FCFA/mois</p>
                    </div>
                    <div id="subscriptionStatus" class="text-center">
                        <!-- Subscription status will be shown here -->
                    </div>
                    <button id="subscribeBtn" onclick="subscribeToAds()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity">
                        S'abonner Maintenant
                    </button>
                </div>
            </div>
        </div>

        <!-- Client Database -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h3 class="font-bold text-lg mb-4 flex items-center">
                <span class="mr-2">👥</span>
                Base de Données Clients
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-left py-3 px-4 font-medium text-gray-600">Nom</th>
                            <th class="text-left py-3 px-4 font-medium text-gray-600">Téléphone</th>
                            <th class="text-left py-3 px-4 font-medium text-gray-600">Avoir</th>
                            <th class="text-left py-3 px-4 font-medium text-gray-600">Points</th>
                            <th class="text-left py-3 px-4 font-medium text-gray-600">Inscription</th>
                        </tr>
                    </thead>
                    <tbody id="clientDatabase">
                        <!-- Client data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Create Ad Form (only if subscribed) -->
        <div id="createAdSection" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
            <h3 class="font-bold text-lg mb-4 flex items-center">
                <span class="mr-2">✨</span>
                Créer une Publicité
            </h3>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <input type="text" id="adTitleInput" placeholder="Titre de la pub" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <textarea id="adTextInput" placeholder="Texte de la pub" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                    <select id="adCategory" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="">Catégorie</option>
                        <option value="promotion">Promotion</option>
                        <option value="nouveau">Nouveau produit</option>
                        <option value="service">Service</option>
                        <option value="evenement">Événement</option>
                    </select>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium mb-3">Aperçu de la pub</h4>
                    <div class="ad-banner text-white p-3 rounded-lg text-center">
                        <div class="flex items-center justify-center space-x-2">
                            <span class="text-xl">🎉</span>
                            <div>
                                <p class="font-bold text-sm" id="previewTitle">Votre titre ici</p>
                                <p class="text-xs" id="previewText">Votre texte ici</p>
                            </div>
                            <span class="text-xs bg-white/20 px-2 py-1 rounded">Pub</span>
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-gray-600">
                        <p>📊 Pubs restantes cette semaine: <span id="remainingAds" class="font-bold">3</span></p>
                    </div>
                </div>
            </div>
            <button onclick="createAd()" class="w-full mt-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity">
                Publier la Publicité
            </button>
        </div>

        <!-- Ad Management -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="font-bold text-lg mb-4 flex items-center">
                <span class="mr-2">📊</span>
                Mes Publicités
            </h3>
            <div id="adsList" class="space-y-4">
                <!-- Ads will be populated here -->
            </div>
        </div>
    </div>

    <!-- Client Dashboard -->
    <div id="clientDashboard" class="max-w-4xl mx-auto px-4 py-8" style="display: none;">
        <!-- Client Balance Cards -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <div class="balance-card p-6 rounded-xl shadow-lg text-white">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold text-lg">Mon Solde Total</h3>
                    <span class="text-2xl">💰</span>
                </div>
                <p id="clientBalance" class="text-3xl font-bold mb-2">15,750 FCFA</p>
                <p class="text-white/80 text-sm">Disponible dans 3 boutiques</p>
            </div>

            <div class="points-card p-6 rounded-xl shadow-lg text-white">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold text-lg">Points Fidélité</h3>
                    <span class="text-2xl">⭐</span>
                </div>
                <p id="clientPoints" class="text-3xl font-bold mb-2">1,240 pts</p>
                <p class="text-white/80 text-sm">Échangeable contre des avoirs</p>
            </div>
        </div>

        <!-- Client Actions -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">📤</span>
                    Envoyer un Avoir
                </h3>
                <div class="space-y-4">
                    <input type="tel" id="sendToPhone" placeholder="Numéro destinataire" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <input type="number" id="sendAmount" placeholder="Montant à envoyer" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <select id="sendFromShop" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="">Choisir la boutique</option>
                    </select>
                    <button onclick="sendAvoir()" class="w-full gradient-bg text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity">
                        Envoyer l'Avoir
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">🎁</span>
                    Échanger des Points
                </h3>
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-600 mb-2">Taux d'échange</p>
                        <p class="font-bold">100 points = 500 FCFA</p>
                    </div>
                    <input type="number" id="pointsToExchange" placeholder="Nombre de points" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <button onclick="exchangePoints()" class="w-full bg-yellow-500 text-white font-medium py-3 rounded-lg hover:bg-yellow-600 transition-colors">
                        Échanger les Points
                    </button>
                </div>
            </div>
        </div>

        <!-- Client Avoirs by Shop -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h3 class="font-bold text-lg mb-4 flex items-center">
                <span class="mr-2">🏪</span>
                Mes Avoirs par Boutique
            </h3>
            <div id="clientShops" class="space-y-4">
                <!-- Shop avoirs will be populated here -->
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification bg-white rounded-lg shadow-lg p-4 border-l-4 border-green-500">
        <div class="flex items-center">
            <span id="notificationIcon" class="text-2xl mr-3">✅</span>
            <div>
                <p id="notificationTitle" class="font-medium text-gray-800">Succès</p>
                <p id="notificationMessage" class="text-sm text-gray-600">Opération réalisée avec succès</p>
            </div>
        </div>
    </div>

    <script>
        // Database simulation
        let users = {
            '+22501234567': {
                name: 'Amadou Diallo',
                password: '123456',
                type: 'client',
                avoirs: {
                    'MC001': 8500,
                    'SM002': 4250,
                    'PH003': 3000
                },
                points: 1240,
                registrationDate: '2024-01-15',
                transactions: []
            },
            '+22507654321': {
                name: 'Fatou Sow',
                password: '123456',
                type: 'client',
                avoirs: {
                    'MC001': 12000,
                    'SM002': 2500
                },
                points: 890,
                registrationDate: '2024-01-20',
                transactions: []
            },
            '+22512345678': {
                name: 'Boutique Centrale',
                password: 'admin123',
                type: 'merchant',
                shopId: 'MC001',
                shopName: 'Boutique Centrale',
                registrationDate: '2024-01-01',
                adRevenue: 12500
            }
        };

        let shops = {
            'MC001': 'Boutique Centrale',
            'SM002': 'Super Marché Plus',
            'PH003': 'Pharmacie Santé'
        };

        let ads = [
            {
                id: 1,
                merchantId: '+22512345678',
                title: 'Promotion Spéciale !',
                text: '-20% sur tous les produits chez SuperMarché Plus',
                category: 'promotion',
                active: true,
                createdDate: '2024-01-25',
                weekCreated: 4 // Week number of 2024
            }
        ];

        let subscriptions = {
            '+22512345678': {
                active: true,
                startDate: '2024-01-01',
                endDate: '2024-02-01',
                monthlyFee: 15000,
                adsThisWeek: 1,
                maxAdsPerWeek: 3
            }
        };

        let currentUser = null;
        let currentUserType = null;

        // Login/Register Functions
        function showLogin() {
            document.getElementById('loginTab').className = 'flex-1 py-2 px-4 rounded-md font-medium transition-all bg-white text-purple-600 shadow-sm';
            document.getElementById('registerTab').className = 'flex-1 py-2 px-4 rounded-md font-medium transition-all text-gray-600';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('loginTab').className = 'flex-1 py-2 px-4 rounded-md font-medium transition-all text-gray-600';
            document.getElementById('registerTab').className = 'flex-1 py-2 px-4 rounded-md font-medium transition-all bg-white text-purple-600 shadow-sm';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function toggleShopField() {
            const userType = document.getElementById('registerUserType').value;
            const shopField = document.getElementById('shopNameField');
            shopField.style.display = userType === 'merchant' ? 'block' : 'none';
        }

        function login() {
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;
            const userType = document.getElementById('loginUserType').value;

            if (!phone || !password) {
                showNotification('Erreur', 'Veuillez remplir tous les champs', 'error');
                return;
            }

            if (users[phone] && users[phone].password === password && users[phone].type === userType) {
                currentUser = phone;
                currentUserType = userType;
                showMainApp();
                showNotification('Connexion réussie', `Bienvenue ${users[phone].name}`, 'success');
            } else {
                showNotification('Erreur', 'Identifiants incorrects', 'error');
            }
        }

        function register() {
            const name = document.getElementById('registerName').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const userType = document.getElementById('registerUserType').value;
            const shopName = document.getElementById('registerShopName').value;

            if (!name || !phone || !password || !confirmPassword) {
                showNotification('Erreur', 'Veuillez remplir tous les champs', 'error');
                return;
            }

            if (userType === 'merchant' && !shopName) {
                showNotification('Erreur', 'Veuillez saisir le nom de votre boutique', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('Erreur', 'Les mots de passe ne correspondent pas', 'error');
                return;
            }

            if (users[phone]) {
                showNotification('Erreur', 'Ce numéro est déjà enregistré', 'error');
                return;
            }

            // Create new user
            const newUser = {
                name: name,
                password: password,
                type: userType,
                registrationDate: new Date().toISOString().split('T')[0],
                transactions: []
            };

            if (userType === 'client') {
                newUser.avoirs = {};
                newUser.points = 0;
            } else {
                newUser.shopId = 'SH' + Date.now();
                newUser.shopName = shopName;
                newUser.adRevenue = 0;
                shops[newUser.shopId] = shopName;
            }

            users[phone] = newUser;
            
            showNotification('Inscription réussie', 'Votre compte a été créé avec succès', 'success');
            
            // Clear form
            document.getElementById('registerName').value = '';
            document.getElementById('registerPhone').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerConfirmPassword').value = '';
            document.getElementById('registerShopName').value = '';
            
            showLogin();
        }

        function logout() {
            currentUser = null;
            currentUserType = null;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainNav').style.display = 'none';
            document.getElementById('merchantDashboard').style.display = 'none';
            document.getElementById('clientDashboard').style.display = 'none';
            document.getElementById('adBanner').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainNav').style.display = 'block';
            
            const user = users[currentUser];
            document.getElementById('currentUser').textContent = user.name;
            document.getElementById('currentUserType').textContent = user.type === 'merchant' ? 'Commerçant' : 'Client';

            if (currentUserType === 'merchant') {
                document.getElementById('merchantDashboard').style.display = 'block';
                document.getElementById('clientDashboard').style.display = 'none';
                document.getElementById('adBanner').style.display = 'none';
                updateMerchantDashboard();
            } else {
                document.getElementById('merchantDashboard').style.display = 'none';
                document.getElementById('clientDashboard').style.display = 'block';
                document.getElementById('adBanner').style.display = 'block';
                updateClientDashboard();
                showRandomAd();
            }
        }

        // Subscription Functions
        function subscribeToAds() {
            const merchant = users[currentUser];
            
            if (subscriptions[currentUser] && subscriptions[currentUser].active) {
                showNotification('Déjà abonné', 'Vous avez déjà un abonnement actif', 'error');
                return;
            }

            // Simulate payment process
            const confirmed = confirm(`Confirmer l'abonnement publicitaire ?\n\nPack: 3 pubs/semaine\nPrix: 15,000 FCFA/mois\n\nCet abonnement vous permet de créer jusqu'à 3 publicités par semaine.`);
            
            if (confirmed) {
                const startDate = new Date();
                const endDate = new Date();
                endDate.setMonth(endDate.getMonth() + 1);

                subscriptions[currentUser] = {
                    active: true,
                    startDate: startDate.toISOString().split('T')[0],
                    endDate: endDate.toISOString().split('T')[0],
                    monthlyFee: 15000,
                    adsThisWeek: 0,
                    maxAdsPerWeek: 3
                };

                updateMerchantDashboard();
                showNotification('Abonnement Activé', 'Votre abonnement publicitaire est maintenant actif ! Vous pouvez créer jusqu\'à 3 pubs par semaine.', 'success');
            }
        }

        function createAd() {
            const title = document.getElementById('adTitleInput').value;
            const text = document.getElementById('adTextInput').value;
            const category = document.getElementById('adCategory').value;

            if (!title || !text || !category) {
                showNotification('Erreur', 'Veuillez remplir tous les champs', 'error');
                return;
            }

            const subscription = subscriptions[currentUser];
            if (!subscription || !subscription.active) {
                showNotification('Erreur', 'Vous devez avoir un abonnement actif pour créer des publicités', 'error');
                return;
            }

            const currentWeek = getWeekNumber(new Date());
            const weeklyAds = ads.filter(ad => 
                ad.merchantId === currentUser && 
                ad.weekCreated === currentWeek
            ).length;

            if (weeklyAds >= subscription.maxAdsPerWeek) {
                showNotification('Limite atteinte', `Vous avez déjà créé ${subscription.maxAdsPerWeek} publicités cette semaine`, 'error');
                return;
            }

            const newAd = {
                id: Date.now(),
                merchantId: currentUser,
                title: title,
                text: text,
                category: category,
                active: true,
                createdDate: new Date().toISOString().split('T')[0],
                weekCreated: currentWeek
            };

            ads.push(newAd);
            subscription.adsThisWeek = weeklyAds + 1;

            document.getElementById('adTitleInput').value = '';
            document.getElementById('adTextInput').value = '';
            document.getElementById('adCategory').value = '';

            updateMerchantDashboard();
            showNotification('Pub créée', 'Votre publicité est maintenant diffusée auprès de tous les clients !', 'success');
        }

        function showRandomAd() {
            const activeAds = ads.filter(ad => ad.active);
            if (activeAds.length > 0) {
                const randomAd = activeAds[Math.floor(Math.random() * activeAds.length)];
                document.getElementById('adTitle').textContent = randomAd.title;
                document.getElementById('adText').textContent = randomAd.text;
                
                // Rotate ads every 15 seconds
                setTimeout(showRandomAd, 15000);
            }
        }

        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        // Existing functions (createAvoir, processPayment, etc.) remain the same...
        function createAvoir() {
            const phone = document.getElementById('clientPhone').value;
            const amount = parseFloat(document.getElementById('avoirAmount').value);

            if (!phone || !amount || amount <= 0) {
                showNotification('Erreur', 'Veuillez remplir tous les champs correctement', 'error');
                return;
            }

            if (!users[phone] || users[phone].type !== 'client') {
                showNotification('Erreur', 'Client non trouvé ou non inscrit', 'error');
                return;
            }

            const merchantShopId = users[currentUser].shopId;
            
            if (!users[phone].avoirs[merchantShopId]) {
                users[phone].avoirs[merchantShopId] = 0;
            }

            users[phone].avoirs[merchantShopId] += amount;
            users[phone].points += Math.floor(amount / 100);

            document.getElementById('clientPhone').value = '';
            document.getElementById('avoirAmount').value = '';

            updateMerchantDashboard();
            showNotification('Avoir Créé', `Avoir de ${amount} FCFA créé pour ${users[phone].name}`, 'success');
        }

        function processPayment() {
            const phone = document.getElementById('paymentPhone').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value);

            if (!phone || !amount || amount <= 0) {
                showNotification('Erreur', 'Veuillez remplir tous les champs correctement', 'error');
                return;
            }

            if (!users[phone] || users[phone].type !== 'client') {
                showNotification('Erreur', 'Client non trouvé', 'error');
                return;
            }

            const merchantShopId = users[currentUser].shopId;
            
            if (!users[phone].avoirs[merchantShopId] || users[phone].avoirs[merchantShopId] < amount) {
                showNotification('Erreur', 'Solde insuffisant pour ce client', 'error');
                return;
            }

            users[phone].avoirs[merchantShopId] -= amount;
            users[phone].points += Math.floor(amount / 50);

            document.getElementById('paymentPhone').value = '';
            document.getElementById('paymentAmount').value = '';

            updateMerchantDashboard();
            showNotification('Paiement Traité', `Paiement de ${amount} FCFA traité pour ${users[phone].name}`, 'success');
        }

        function updateMerchantDashboard() {
            const merchant = users[currentUser];
            const shopId = merchant.shopId;
            const subscription = subscriptions[currentUser];
            
            let totalAvoirs = 0;
            let registeredClients = 0;
            
            Object.values(users).forEach(user => {
                if (user.type === 'client') {
                    registeredClients++;
                    if (user.avoirs[shopId]) {
                        totalAvoirs += user.avoirs[shopId];
                    }
                }
            });

            document.getElementById('totalAvoirs').textContent = `${totalAvoirs.toLocaleString()} FCFA`;
            document.getElementById('registeredClients').textContent = registeredClients;

            // Update subscription status
            const isSubscribed = subscription && subscription.active;
            document.getElementById('subscriptionStatus2').textContent = isSubscribed ? 'Actif' : 'Inactif';
            document.getElementById('subscriptionStatus2').className = `text-2xl font-bold ${isSubscribed ? 'text-green-600' : 'text-gray-800'}`;

            // Update weekly ads count
            const currentWeek = getWeekNumber(new Date());
            const weeklyAdsCount = ads.filter(ad => 
                ad.merchantId === currentUser && 
                ad.weekCreated === currentWeek
            ).length;
            document.getElementById('weeklyAds').textContent = `${weeklyAdsCount}/3`;

            // Update subscription UI
            updateSubscriptionUI();
            updateClientDatabase();
            updateAdsList();
        }

        function updateSubscriptionUI() {
            const subscription = subscriptions[currentUser];
            const subscriptionStatusDiv = document.getElementById('subscriptionStatus');
            const subscribeBtn = document.getElementById('subscribeBtn');
            const createAdSection = document.getElementById('createAdSection');

            if (subscription && subscription.active) {
                subscriptionStatusDiv.innerHTML = `
                    <div class="bg-green-100 p-3 rounded-lg text-green-800">
                        <p class="font-bold">✅ Abonnement Actif</p>
                        <p class="text-sm">Expire le: ${new Date(subscription.endDate).toLocaleDateString('fr-FR')}</p>
                        <p class="text-sm">Pubs cette semaine: ${subscription.adsThisWeek || 0}/3</p>
                    </div>
                `;
                subscribeBtn.textContent = 'Renouveler l\'abonnement';
                subscribeBtn.className = 'w-full bg-gray-400 text-white font-medium py-3 rounded-lg cursor-not-allowed';
                subscribeBtn.disabled = true;
                createAdSection.style.display = 'block';

                // Update remaining ads counter
                const currentWeek = getWeekNumber(new Date());
                const weeklyAdsCount = ads.filter(ad => 
                    ad.merchantId === currentUser && 
                    ad.weekCreated === currentWeek
                ).length;
                document.getElementById('remainingAds').textContent = 3 - weeklyAdsCount;

                // Update preview on input
                document.getElementById('adTitleInput').oninput = function() {
                    document.getElementById('previewTitle').textContent = this.value || 'Votre titre ici';
                };
                document.getElementById('adTextInput').oninput = function() {
                    document.getElementById('previewText').textContent = this.value || 'Votre texte ici';
                };
            } else {
                subscriptionStatusDiv.innerHTML = `
                    <div class="bg-red-100 p-3 rounded-lg text-red-800">
                        <p class="font-bold">❌ Pas d'abonnement</p>
                        <p class="text-sm">Abonnez-vous pour créer des publicités</p>
                    </div>
                `;
                subscribeBtn.textContent = 'S\'abonner Maintenant';
                subscribeBtn.className = 'w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity';
                subscribeBtn.disabled = false;
                createAdSection.style.display = 'none';
            }
        }

        function updateClientDatabase() {
            const tbody = document.getElementById('clientDatabase');
            const clients = Object.entries(users).filter(([phone, user]) => user.type === 'client');
            const shopId = users[currentUser].shopId;

            tbody.innerHTML = clients.map(([phone, client]) => `
                <tr class="border-b border-gray-100">
                    <td class="py-3 px-4 text-sm font-medium">${client.name}</td>
                    <td class="py-3 px-4 text-sm">${phone}</td>
                    <td class="py-3 px-4 text-sm font-medium">${(client.avoirs[shopId] || 0).toLocaleString()} FCFA</td>
                    <td class="py-3 px-4 text-sm">${client.points} pts</td>
                    <td class="py-3 px-4 text-sm">${client.registrationDate}</td>
                </tr>
            `).join('');
        }

        function updateAdsList() {
            const merchantAds = ads.filter(ad => ad.merchantId === currentUser);
            const adsList = document.getElementById('adsList');

            if (merchantAds.length === 0) {
                adsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <span class="text-4xl mb-4 block">📢</span>
                        <p>Aucune publicité créée</p>
                        <p class="text-sm">Abonnez-vous pour commencer à créer des publicités</p>
                    </div>
                `;
                return;
            }

            adsList.innerHTML = merchantAds.map(ad => `
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-bold">${ad.title}</h4>
                            <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 mr-2">
                                ${ad.category}
                            </span>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full ${ad.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${ad.active ? 'Diffusée' : 'Inactive'}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">${ad.text}</p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-gray-500">Date de création</p>
                            <p class="font-medium">${new Date(ad.createdDate).toLocaleDateString('fr-FR')}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Statut</p>
                            <p class="font-medium text-green-600">✅ Visible par tous les clients</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateClientDashboard() {
            const client = users[currentUser];
            
            const totalBalance = Object.values(client.avoirs).reduce((sum, balance) => sum + balance, 0);
            document.getElementById('clientBalance').textContent = `${totalBalance.toLocaleString()} FCFA`;
            document.getElementById('clientPoints').textContent = `${client.points.toLocaleString()} pts`;

            // Update shops dropdown and list
            const sendFromShop = document.getElementById('sendFromShop');
            sendFromShop.innerHTML = '<option value="">Choisir la boutique</option>' + 
                Object.entries(client.avoirs).map(([shopId, balance]) => 
                    `<option value="${shopId}">${shops[shopId]} (${balance.toLocaleString()} FCFA)</option>`
                ).join('');

            const shopsDiv = document.getElementById('clientShops');
            shopsDiv.innerHTML = Object.entries(client.avoirs).map(([shopId, balance]) => `
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <div>
                        <h4 class="font-medium">${shops[shopId]}</h4>
                        <p class="text-sm text-gray-600">ID: ${shopId}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-lg">${balance.toLocaleString()} FCFA</p>
                        <p class="text-sm text-gray-600">Disponible</p>
                    </div>
                </div>
            `).join('');
        }

        function sendAvoir() {
            const toPhone = document.getElementById('sendToPhone').value;
            const amount = parseFloat(document.getElementById('sendAmount').value);
            const fromShop = document.getElementById('sendFromShop').value;

            if (!toPhone || !amount || !fromShop || amount <= 0) {
                showNotification('Erreur', 'Veuillez remplir tous les champs correctement', 'error');
                return;
            }

            if (!users[toPhone] || users[toPhone].type !== 'client') {
                showNotification('Erreur', 'Destinataire non trouvé ou non inscrit', 'error');
                return;
            }

            if (!users[currentUser].avoirs[fromShop] || users[currentUser].avoirs[fromShop] < amount) {
                showNotification('Erreur', 'Solde insuffisant dans cette boutique', 'error');
                return;
            }

            users[currentUser].avoirs[fromShop] -= amount;

            if (!users[toPhone].avoirs[fromShop]) {
                users[toPhone].avoirs[fromShop] = 0;
            }
            users[toPhone].avoirs[fromShop] += amount;

            document.getElementById('sendToPhone').value = '';
            document.getElementById('sendAmount').value = '';
            document.getElementById('sendFromShop').value = '';

            updateClientDashboard();
            showNotification('Avoir Envoyé', `${amount} FCFA envoyé à ${users[toPhone].name}`, 'success');
        }

        function exchangePoints() {
            const points = parseInt(document.getElementById('pointsToExchange').value);

            if (!points || points <= 0 || points > users[currentUser].points) {
                showNotification('Erreur', 'Nombre de points invalide', 'error');
                return;
            }

            if (points < 100) {
                showNotification('Erreur', 'Minimum 100 points requis', 'error');
                return;
            }

            const avoirAmount = (points / 100) * 500;
            users[currentUser].points -= points;
            
            // Add to first available shop or create new entry
            const firstShop = Object.keys(users[currentUser].avoirs)[0] || 'MC001';
            if (!users[currentUser].avoirs[firstShop]) {
                users[currentUser].avoirs[firstShop] = 0;
            }
            users[currentUser].avoirs[firstShop] += avoirAmount;

            document.getElementById('pointsToExchange').value = '';
            updateClientDashboard();
            showNotification('Points Échangés', `${points} points échangés contre ${avoirAmount} FCFA`, 'success');
        }

        function showNotification(title, message, type = 'success') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');

            titleEl.textContent = title;
            messageEl.textContent = message;

            if (type === 'success') {
                icon.textContent = '✅';
                notification.className = 'notification bg-white rounded-lg shadow-lg p-4 border-l-4 border-green-500';
            } else {
                icon.textContent = '❌';
                notification.className = 'notification bg-white rounded-lg shadow-lg p-4 border-l-4 border-red-500';
            }

            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // App starts with login screen
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ff2c319158534c',t:'MTc1ODAxMzIxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
